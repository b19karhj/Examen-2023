<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="#">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <style>
        body {
            height: 100vh;
        }

        #container {
            display: flex;
            flex-direction: row;
            padding: 10px;
        }

        #containerArray {
            display: flex;
            flex-direction: row;
            padding: 10px;
        }

        .arraySegments {
            margin-right: 10px;
            font-size: 1.3em;
        }

        #page1 {
            display: block;
            width: 100%;
            min-height: 100%;
            position: absolute;
        }

        #page2 {
            display: none;
            width: 100%;
            min-height: 100%;
            position: absolute;
        }
        #page3 {
            display: none;
            position: relative;
            height: 100vh; 
        }
        #thanksTitle{
            display: flex;
            justify-content: center;
            font-size: 3em;
            margin-top: 40%;

        }

        #formContainer {
            width: 50%;
            height: 80%;
            margin: auto;

        }

        form {
            border: 2px solid black;
        }

        .formL {
            padding-top: 10px;
            display: inline-block;
            font-size: 1.05em;

        }

        fieldset {
            border: 2px solid black;
            margin: 10px;
            padding-right: 5px;
            padding-bottom: 5px;

        }

        input {
            margin: 5px;

        }

        #formH {
            text-align: center;
        }

        .p1 {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #button {
            display: block;
            margin: 10px;
        }

        .l1 {
            display: inline-block;
            width: 200px;
            text-align: right;
            margin-right: 10px;
        }

        button {
            height: 50px;
            width: 50px;
        }

        #googleFieldContianer {
            border: 2px solid black;
            margin: 10px;
            padding-right: 5px;
            padding-bottom: 5px;
        }

        #innerGdiv {
            display: flex;
            flex-direction: row;
        }

        #msagoogleFieldContianer{
            border: 2px solid black;
            margin: 10px;
            padding-right: 5px;
            padding-bottom: 5px;
        }

        .legendp1 {
            padding-left: 5px;
            padding-right: 5px;
        }

        #innerMSAdiv {
            display: flex;
            flex-direction: row;
        }

        #info {
            position: absolute;
            width: 40%;
            border: 2px solid black;
            background-color: gray;
            display: block;
            padding: 20px;
            max-width: 885px;
            z-index: 2;
        }

        li {
            margin-top: 3px;
            margin-bottom: 3px;
        }

        h3 {
            margin-top: 0px;
            margin-bottom: 0px;
            margin-left: 30px;
        }

        .intro {
            margin-left: 30px;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        #infoBtn {
            margin-top: 30px;
            height: 30px;
            width: 30vw;
            max-width: 500px;
            font-size: 1.2em;
        }

        #infoBtn:hover {
            background-color: green;
        }

        #segmentedPasswordInfo{
            top: 1%;
            position: relative;
        }

        #warningGooglePassword {
            border: 2px solid black;
            height: 30px;
            width: 400px;
            background-color: #ED675F;
            display: none;
        }

        #warningMSASegmentedPassword {
            border: 2px solid black;
            height: 30px;
            width: 800px;
            background-color: #ED675F;
            display: none;
        }

        .loading {
            display: flex;
            justify-content: center;
            margin-top: 50vh;
            position: relative;
        }

        #containerloading {
            position: absolute;
            height: 100%;
            width: 100%;
            display: none;
            z-index: 5;
            backdrop-filter: blur(5px);

        }

        #iconText {
            position: absolute;
            bottom: 70px;
            text-align: center;
        }

        #iconText2 {
            position: absolute;
            bottom: 70px;
            text-align: center;
        }
  

        .loading::after {
            content: "";
            width: 200px;
            height: 200px;
            border: 30px solid #ddd;
            border-right-color: rgb(24, 128, 93);
            border-left-color: rgb(24, 128, 93);
            border-top: none;
            border-bottom: none;
            border-radius: 50%;
            animation: loading 1s ease infinite;
        }

        @keyframes loading {
            to {
                transform: rotate(1turn);
            }
        }
    </style>
</head>

<body onload="">
    <!-- Password box for google guidline passwords-->
    <div id="page1">
        <div class="p1">
            <div id="containerloading">
                <div class="loading">
                    <p id="iconText">Working:<br>Process can take up to ~3 min</p>
                    <p id="iconText2">Checking Google password</p>
                </div>
            </div>
            <div id="info">
                <p class="intro">Hello and welcome to a study for a thesis which tries to evaluate the impact on
                    password creation through a validation service which is using a segmentation algorithm.</p><br>
                <p class="intro">Your participation will take 2 - 5 minutes.</p><br>
                <p class="intro">The goal of this thesis is to evaluate if segmented password created with a segmention algorithm is stronger than password created Googles password guidelines.<br>
                    Please treat the password creation as you would when you are signing up with any service on the internet which include passwords</p><br>   
                <h3>Important!</h3>
                <ul>
                    <li>Your participation will be anonymous.</li>
                    <li>If you wish to not take part in this study you can just close the website down at anytime during
                        your participation.</li>
                    <li>All data submitted is safely stored in a database.</li>
                    <li>The data you submit will only be shown as statistics.</li>
                    <li>The data you submit will be deleted after statistics gathering has been done.</li>
                </ul>
                <button id="infoBtn">I understand</button>
            </div>
            <div id="segmentedPasswordInfo">
                <fieldset>
                    <legend>How segmented password works</legend>
                    <p>A segment in a password is simply a bundle of the same set of characters in a password.<br>
                    <p>A segment can consist of numbers, letters or symbols.</p>
                    <p>When using letters only english letters are allowed!</p>
                    <fieldset>
                        <legend>Example 1</legend>
                        <p>“Hello123” consists of two segments “Hello” and “123”.</p>
                    </fieldset>
                    <p>Segments can be combined into words.</p>
                    <fieldset>
                        <legend>Example 2</legend>
                        <p>“P@ssw0rd” Consists of 5 segments “P”, “@”, “ssw”, 0”, “rd”.</p>
                    </fieldset>
                    <p>The algorithm in this validation service will try to figure out masked words in password so it
                        can be compared to earlier leaked passwords from databases.</p>
                    <fieldset>
                        <legend>Example 3</legend>
                        <p>“P@ssw0rd123” consists of 6 segments, but the algorithm will treat it as two segments when
                            evaluating the password “P@ssw0rd”, “123”.</p>
                    </fieldset>
                </fieldset>
            </div>
            <div id="page1Container">
                <fieldset id="googleFieldContianer">
                    <legend class="legendp1">Google guideline password</legend>
                    <div id="innerGdiv">
                        <input type="text" id="googlePassword" name="google">
                        <div>
                            <p>Use 8 characters or more with a mix of letters, numbers & symbols.</p>
                        </div>
                    </div>
                    <div id="warningGooglePassword"><span id="googleWarningTextSpan"></span></div>
                </fieldset>
                <!-- Password box for MSA passwords-->
                <div>
                    <fieldset id="msagoogleFieldContianer">
                        <legend class="legendp1">Segmented password</legend>
                        <div id="innerMSAdiv">
                            <input type="text" id="msaPassword" name="MSA">
                            <div>
                                <p>Between 8-20 characters. Mix of letters, numbers and symbols. The password most
                                    contain at least 4 segments</p>
                            </div>
                        </div>
                        <div id="warningMSASegmentedPassword"><span id="msaWarningTextSpan"></span></div>
                        <div id="container" class="arraySegments"></div>
                    </fieldset>
                </div>
                <input id="button" type="submit" value="submit2" onclick="load();">
            </div>
        </div>
    </div>
    <div id="page2">
        <div id="formContainer">
            <form id="form">
                <h1 id="formH">Your password have been accepted!</h1>
                <div id="containerArray" class="arraySegments"></div>
                <fieldset>
                    <label class="formL" for="q1">Was the segmentation of your password corrrect?</label>
                    <br>
                    <label>Yes</label>
                    <input type="radio" class="q1" name="q1" value="yes"><br>
                    <label>No</label>
                    <input type="radio" class="q1" name="q1" value="no">
                    <br>
                </fieldset>
                <fieldset>
                    <label class="formL" for="q2">Do you feel that the validation service for segmented password helped you create a
                        strong password?</label>
                    <br>
                    <label>Yes</label>
                    <input type="radio" id="q3yes" name="q2" value="yes"><br>
                    <label>No</label>
                    <input type="radio" id="q3no" name="q2" value="no"><br>
                </fieldset>
                <fieldset>
                    <label class="formL" for="q4">Do you think the segmented password you created would be easy to
                        remember?</label>
                    <br>
                    <label>Yes</label>
                    <input type="radio" id="q4yes" name="q3" value="yes"><br>
                    <label>No</label>
                    <input type="radio" id="q4no" name="q3" value="no">
                    <br>
                </fieldset>
                <fieldset>
                    <label class="formL" for="q4">Was the feedback given helpful, if one or more segments were not
                        deemed safe?</label>
                    <br>
                    <label>Yes</label>
                    <input type="radio" id="q4yes" name="q4" value="yes"><br>
                    <label>No</label>
                    <input type="radio" id="q4no" name="q4" value="no"><br>
                    <label>My password got accepted on the first attempt</label>
                    <input type="radio" id="q4first" name="q4" value="accepted">
                    <br>
                </fieldset>
                <fieldset>
                    <label class="formL" for="q6">How many attempts did it take you to get your password
                        accepted?</label>
                    <br>
                    <label>Less than 3 attepmts</label>
                    <input type="radio" id="q5less" name="q5" value="lessthan3"><br>
                    <label>More than 3 attempts</label>
                    <input type="radio" id="q5more" name="q5" value="morethan3">
                    <br>
                </fieldset>
                <button type="submit">Submit</button>
            </form>
        </div>
    </div>
    <div id="page3">
        <h1 id="thanksTitle">Thank you for taking part in this study!</h1>
    </div>
    <script>
        
        //Functions for loading animation

        function msaLoadingFunction() {
            document.getElementById("iconText2").style.display = "none";
            document.getElementById("iconText").style.display = "block";
            document.getElementById("containerloading").style.display = "block";
        }
        function googleLoadingFunction() {
            document.getElementById("iconText").style.display = "none";
            document.getElementById("iconText2").style.display = "block";
            document.getElementById("containerloading").style.display = "block";
        }

        function stopLoadingIcon() {
            document.getElementById("containerloading").style.display = "none";
        }

        //Event listener for when info button is clicked (does not display if clicked)
        
        document.getElementById("infoBtn").addEventListener("click", displayInfo);
        function displayInfo() {
            document.getElementById("info").style.display = "none";
        }
       
        //Checks if passwords have all requirments
        function load(){
            var googleValueCheck = document.getElementById("googlePassword").value;
            if(googleValueCheck.length != 0){
                googleLoadingFunction();
                setTimeout(function() { //timeout is needed otherwise the async function will make loading function not load.
                    passwordCheck();
                }, 100);
            }
        }
        
       async function passwordCheck() {
            //Checking Google Password
            let googleCheck = false;
            let googleDbCheck = false;
            var googleInput = document.getElementById("googlePassword");
            var googleInputValue = document.getElementById("googlePassword").value;
            let googleWarningDiv = document.getElementById("warningGooglePassword");
            let googleWarningText = document.getElementById("googleWarningTextSpan");
            var googleResult;
            if(googleInputValue.length >= 8)
            {          
                googleInput.style.backgroundColor = "lightgreen";
                googleWarningDiv.style.display = "none";
                googleResult = await googlePasswordCheck(googleInputValue);
                googleResult = JSON.parse(googleResult);
                googleCheck = true;
               
            }
            else if(googleInputValue.length < 8){
                stopLoadingIcon();
                googleInput.style.backgroundColor = "#ED675F";
                googleWarningText.innerHTML = "Less than 8 characters long";
                googleWarningDiv.style.display = "block";
                
            }
          
          

            if(googleResult == true)
            {
                stopLoadingIcon();
                googleDbCheck = true;
            }
            else if(googleResult == false)
            {
                stopLoadingIcon();
                googleInput.style.backgroundColor = "#ED675F";
                googleWarningText.innerHTML = "The password " + googleInputValue + " has been leaked before and is not safe! Try a different password";
                googleWarningDiv.style.display = "block";
            }

            //Checking MSA Password
            let msaInput = document.getElementById("msaPassword");
            let msaInputValue = document.getElementById("msaPassword").value;
            let msaInputValueArray = [];
            let msaSegmentCheckArray = [];
            let msaCheck = false;
            let msaWarningDiv = document.getElementById("warningMSASegmentedPassword");
            let msaWarningSpan = document.getElementById("msaWarningTextSpan");

            const onlyContainNumbers =  /^[0-9]+$/;  //Only contain numbers
            const onlyContainSymbols = /^[\W_]+$/;   //Only contain symbols
            const onlyContainNumbersAndSymbols = /^[\d\W]+$/;   //Only contain numbers and symbols
            const onlyLetters = /^[a-zA-Z]+$/;
            const onlyAllowedCharacters =/^[a-zA-Z0-9!@#$%^&*()_+\-=[\]{};':"\\|,.<>\/?]*$/;
            msaInputValueArray = msaInputValue.split("");  //Splits string to array 
            if(msaInputValue.match(onlyAllowedCharacters) && msaInputValue.length <= 20){
                msaInputValueArray = msaInputValue.split("");  //Splits string to array 
                for(let i = 0; i < msaInputValueArray.length; i++){
                    if(i < (msaInputValueArray.length-1)){   //Check to see if i is less then msaInputValueArray. If i is same value, i+1 will be out of bound
                        if(msaInputValueArray[i].match(onlyContainNumbers) && msaInputValueArray[i+1].match(onlyContainNumbers))
                        {  //Check if value of i and i+1 both consist of numbers
                            msaSegmentCheckArray.push(msaInputValueArray[i]);
                        }
                        else if(msaInputValueArray[i].match(onlyContainSymbols) && msaInputValueArray[i+1].match(onlyContainSymbols))
                        {    //Check if value of i and i+1 both consist of symbols
                            msaSegmentCheckArray.push(msaInputValueArray[i]);
                        }
                        else if(msaInputValueArray[i].match(onlyLetters) && msaInputValueArray[i+1].match(onlyLetters))
                        {  //Check if value of i and i+1 are both consist of symbols
                            msaSegmentCheckArray.push(msaInputValueArray[i]);
                        } 
                        else
                        {  //if i and i+1 do not match. its an indication of a new segment.
                            msaSegmentCheckArray.push(msaInputValueArray[i]," "); //Push in value and " " as a new segment will be pushed in next
                        }
                    }
                    if(i == (msaInputValueArray.length-1)){ //Check to see if i value is equal to the last element in msaInputValueArray. Then compare is done to the value before i. As i+1 is out of bound. Same things are happening but with i-1 checks
                        if(msaInputValueArray[i].match(onlyContainNumbers) && msaInputValueArray[i-1].match(onlyContainNumbers))
                        {
                            msaSegmentCheckArray.push(msaInputValueArray[i]);
                        }
                        else if(msaInputValueArray[i].match(onlyContainSymbols) && msaInputValueArray[i-1].match(onlyContainSymbols))
                        {
                            msaSegmentCheckArray.push(msaInputValueArray[i]);
                        }
                        else if(msaInputValueArray[i].match(onlyLetters) && msaInputValueArray[i-1].match(onlyLetters))
                        {
                            msaSegmentCheckArray.push(msaInputValueArray[i]);
                        }
                        else{ 
                            msaSegmentCheckArray.push(msaInputValueArray[i]); //No " " is pushed as its the last value
                        }
                    }
                }
                msaSegmentCheckArray = msaSegmentCheckArray.join("").split(/ /g);                                                                                       //joins and split at " " to get all segments
                if(msaSegmentCheckArray.length >= 4) {
                    msaCheck = true;
                    msaInput.style.background = "lightgreen";
                    msaWarningDiv.style.display = "none";
                }
                else if(msaSegmentCheckArray.length < 4){
                    msaCheck = false;
                    msaInput.style.background = "#ED675F";
                    msaWarningDiv.style.display = "block";
                    msaWarningSpan.innerHTML = 'Less than 4 segments';
                    
                }
            }else{
                msaCheck = false;
                msaInput.style.background = "#ED675F";
                msaWarningDiv.style.display = "block";
                msaWarningSpan.innerHTML = 'Password contains space, non english letters or over 20 characters. (When using letters only use english letters)';
            }
         
            if(googleCheck == true && msaCheck == true && googleDbCheck == true) {
                msaLoadingFunction();
                MSA();
            }
        }

       //Function for checking if words exists with word api

      async function wordChecker(word, checkIfwordExist) {
            console.log(word)
            const url = 'https://wordsapiv1.p.rapidapi.com/words/'+word+'/definitions';
            const options = {
                method: 'GET',
                headers: {
                    'content-type': 'application/octet-stream',
                    'X-RapidAPI-Key': 'd0893958f8mshab5136ec40d6715p1b853ejsn10dd8c67dc00',
                    'X-RapidAPI-Host': 'wordsapiv1.p.rapidapi.com'
                }
            };
            try {
                const response = await fetch(url, options);
                const result = await response.json();
                console.log(result)
                console.log(result.hasOwnProperty("word"))
                if(result.hasOwnProperty("word")){
                    console.log(result)
                    checkIfwordExist(true);
                }
                else{
                    checkIfwordExist(false);
                }
            } catch (error) {
                console.error(error);
            }
           /* return new Promise((resolve, reject) => {
                fetch('https://wordsapiv1.p.mashape.com/words/'+word+'/definitions')
                    .then(response => response.json())
                    .then(response =>{
                        if(response.hasOwnProperty("word")){  //Checks if response object has property word.
                            console.log(response)
                            resolve(true);

                        }else{
                            resolve(false)
                        }

                    })

            })*/
        }

        //Sending passwords to database for searching if matches are found

        function googlePasswordCheck(googleInputValue) {
            return new Promise((resolve, reject) => {
                let googlePasswordDatabaseCheck = JSON.stringify(googleInputValue);
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "Backend.php", false);
                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        resolve(this.responseText);
                    }
                };
                var data = {
                    googlePasswordDatabaseCheck: googlePasswordDatabaseCheck
                };
                var encodedData = Object.keys(data).map(function (key) {
                    return encodeURIComponent(key) + "=" + encodeURIComponent(data[key]);
                }).join("&");
                xhr.send(encodedData);
            });
        }

        function ajaxFunction(purePassword, readyForSend) {
            return new Promise((resolve, reject) => {
                let notSegmentedPassword = JSON.stringify(purePassword);
                let segmentedPassword = JSON.stringify(readyForSend);
            
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "Backend.php", false);
                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        resolve(this.responseText);
                    }
                };
                var data = {
                    notSegmentedPassword: notSegmentedPassword,
                    segmentedPassword: segmentedPassword
                };
                var encodedData = Object.keys(data).map(function (key) {
                    return encodeURIComponent(key) + "=" + encodeURIComponent(data[key]);
                }).join("&");
                xhr.send(encodedData);
            });
        }


        //Checking if all questions have been answered and sending response to database

        const form = document.getElementById("form");
        form.addEventListener("submit", questionnaire);
        function questionnaire(event) {
            count = 0;

            const radioButtons = document.querySelectorAll('input[type="radio"]');  //Gets all input with raidobuttons
            radioButtons.forEach((radio) => {
                if (radio.checked) {
                    count += 1;
                }
            });
            if (count == 5) {
                let q1 = document.querySelector("input[name='q1']:checked").value;
                let q2 = document.querySelector("input[name='q2']:checked").value;
                let q3 = document.querySelector("input[name='q3']:checked").value;
                let q4 = document.querySelector("input[name='q4']:checked").value;
                let q5 = document.querySelector("input[name='q5']:checked").value;
                let passwordGoogle = document.getElementById("googlePassword").value;
                let passwordMSA = document.getElementById("msaPassword").value;
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "completion.php", true);
                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("page2").style.display = "none";
                        document.getElementById("page3").style.display = "block";
                        event.preventDefault();
                    }
                };
                var data = {
                    q1: q1,
                    q2: q2,
                    q3: q3,
                    q4: q4,
                    q5: q5,
                    passwordGoogle: passwordGoogle,
                    passwordMSA: passwordMSA,
                };
                var encodedData = Object.keys(data).map(function (key) {
                    return encodeURIComponent(key) + "=" + encodeURIComponent(data[key]);
                }).join("&");
                xhr.send(encodedData);
                event.preventDefault();

            }else if(count < 5){
                alert("All questions have not been answered");
            }
          
            event.preventDefault();
        };

        //Function that displays password segments for user

        function displaySegments(prepareForSend,containerID) {
            let array = prepareForSend;
            let IDcontainer = containerID;
            var containerPage = document.getElementById(IDcontainer);//Fetch id
            for (let i = 0; i < array.length; i++) {
                var divBoxes = document.createElement("div"); //create span element
                divBoxes.classList.add("arraySegments");  // Add .item
                divBoxes.textContent = array[i];  //Add textcontent from current value of testa.
                containerPage.appendChild(divBoxes); //Append to span to container
            }
        }

        //Function clear divs that display password segments for user

        function clearElements(prepareForSend) {
            if (prepareForSend != null) {
                const list = document.getElementById("container");
                while (list.hasChildNodes()) {
                    list.removeChild(list.firstChild);
                }

            }
        }


        //MSA algorithm
        async function MSA() {

            /////Varibales
            var password; //Stores the password as it was typed (No segmentation)
            var segmentationPasswordMapped;   //Stores passwrod and  maps "leet words"
            var segmentationPassword; //Stores password thats not mapped with "leet words"
            var purePassword; //Stores password as it is and will be sent to database to check for whole password
            var foundSegmentedPassword; //Displays password if exact password is matched in database.
            var storeIValue; //Store value of position i of segmentationPassword
            var tempJoinArrayValue; //Used for join so it can later be pushed into array as a segment
            var containerID; //Used to hold different containting id depending on page'
            var returnData; //Holds return data from ajax request
            var googlePassword; //Holds value of the password typed in google input box
            var colortest = true; //Boolean for checking all colors in display segment
            var outputElements = document.getElementsByClassName("arraySegments"); //Holds the class element that displays segments to user
            var msaWarningDiv = document.getElementById("warningMSASegmentedPassword"); //Golds id of warning div for msaPassword
            var msaWarningSpan = document.getElementById("msaWarningTextSpan"); //Holds id of warning span for msaPassword
            let color; //Holds value of output segments displayed to user

            ///Arrays///
            var segmentationPasswordMappedArray = []; //Stores words and all characters found with segmentationPassword with mapped characters
            var segmentSeperator = []; //Stores space so concating segmentationPassword is correct
            var segmentationPasswordArray = []; //Store matched typed segments from segmentationPasswordMappedArray but with non mapped characters
            var splitPasswordArray = []; //Stores all splitted all elements from the typed in password and puts then in an array 
            var tempStorePushedISplitValues = []; //Temp store values in array
            var arrayForlength = []; //Just a copy of segmentationPassword so the count in for loop can work
            var mirrorCleanArray = []; //Stores the mirrored elements
            var prepareForSend = []; //Stores all segmented values and is used when checking if segment is less than 2
            var readyForSend = []; //Stores segments that will be sent to do database after check if segments are less than 2.
            
            /////////Regex
            const letters = /^[a-zA-Z]/; //First element alphabet character
            const symbol = /^\W/; //First element symbol
            const onlyContainNumbers =  /^[0-9]+$/; //Only contain numbers
            const onlyContainSymbols = /^[\W_]+$/; //Only contain symbols
            const onlyContainNumbersAndSymbols = /^[\d\W]+$/; //Only contain numbers and symbols
            const onlyLetters = /^[a-zA-Z]+$/; //Only letters

            ///////Leet words vocabulary
            const specialDictionary = {
                "@": "a", "λ": "a",
                "8": "b", "ß": "b", "l³": "b", "I3": "b", "J3": "b",
                "©": "c", "¢": "c",
                "đ": "d", "Ð": "d",
                "3": "e", "ε": "e", "£": "e", "€": "e",
                'l²': "f", 'ƒ': "f",
                '6': "G", '9': "g",
                '#': "h", '4': "h",
                '!': "i", '1': "i",
                "0": "o",
                '.-': "r", 'я': "r", '®': "r", '1²': "r",
                '5': "s", 'ş': "s", 'ŝ': "s", '§': "s", '$': "s",
                '7': "t",
                'µ': "u",
                "%": "x", "><": "x",
                "2": "y"
            }

            ///////////////
            ///Sets password to the variables
            password = document.getElementById("msaPassword").value;
            segmentationPasswordMapped = document.getElementById("msaPassword").value;
            segmentationPassword = document.getElementById("msaPassword").value;
            purePassword = document.getElementById("msaPassword").value;
            googlePassword = document.getElementById("googlePassword").value;
            foundSegmentedPassword = document.getElementById("msaPassword").value;
    
            ///////Replaces all specialChars and numbers
            segmentationPasswordMapped = segmentationPasswordMapped.replace(/@|λ|ß|l³|I3|J3|©|¢|đ|Ð|ε|£|€|l²|ƒ|#|}{|!|ỉ|0_|.-|я|®|1²|ş|ŝ|§|µ|%|><|0|1|2|3|4|5|6|7|8|9/g, 
                function (matched) {
                return specialDictionary[matched];
            });
            
            ///Loop to check if segmentationPasswordMapped contains words when its mapped
            sendWord = segmentationPasswordMapped;
            for (let i = 0; i <= segmentationPasswordMapped.length; i++){  
            
                if(segmentationPasswordMapped.match(symbol)){
                    segmentationPasswordMappedArray.push(sendWord[0]);
                    segmentationPasswordMapped = segmentationPasswordMapped.substring(1);
                    sendWord = segmentationPasswordMapped; //Sets the value after substracting
                    //Adds space so concat can be done later on and segments are correct.
                    i = 0; //Resets i otherwise values in the end of the string wont get pushed into array
                }
                if(segmentationPasswordMapped.match(letters)){ //Needs to be in as the api will throw error midway if symbols are sent in as it cant parse it.
                        await wordChecker(sendWord, function (checkIfwordExist)  {
                        console.log(checkIfwordExist, "is");
                    if(checkIfwordExist){
                      
                        segmentationPasswordMappedArray.push(sendWord); //Adds the word to segmentation tracker
                        segmentationPasswordMapped = segmentationPasswordMapped.replace(`${sendWord}`, ""); //Replaces the word in password string with nothing. Example ilove after is love
                        sendWord = segmentationPasswordMapped;
                        i = 0; //Resets i otherwise values in the end of the string wont get pushed into array

                    }
                    else if(checkIfwordExist == false && sendWord.length == 1){ //If temp.length is less then 1 in length, enter here to remove characters.
                    
                        segmentationPasswordMappedArray.push(sendWord);
                        segmentationPasswordMapped = segmentationPasswordMapped.substring(1); //Substact first element
                        sendWord = segmentationPasswordMapped; //Sets sendWord to string value again
                        i = 0;  
                    }
                    else{
                        sendWord = segmentationPasswordMapped.substring(0, segmentationPasswordMapped.length - i); //Removes the last element

                    }     
                    }); //Calls on wordChecker and waits for it to complete
                    
                }
            }

            
            /*Mirror segmentationPassword but with no changed characters. So it can later be checked if a word only consist of
            numbers or symbols and that word can be converted back as its not likley to be what the user meant. As the word api
            atm has odd words like "wr"*/

            arrayForlength = segmentationPasswordMappedArray;
            splitPasswordArray = password.split("");   //Splits all elements from the typed in password and puts then in an array 
            for (i = 0; i < arrayForlength.length; i++) { //Loop throught length of segmentationPassword
                storeIValue = arrayForlength[i];
                for (j = 0; j < storeIValue.length; j++){
                    tempStorePushedISplitValues.push(splitPasswordArray[j]);
                }
                tempJoinArrayValue = tempStorePushedISplitValues.join('');  //joined values
                mirrorCleanArray.push(tempJoinArrayValue);  //Push joined value into array
                splitPasswordArray = splitPasswordArray.slice(storeIValue.length); //Remove the joined elements from the array cointaning "clean" characters
                arrayForlength = arrayForlength.slice(i); //Removes first element from array
                tempStorePushedISplitValues = []; //Reset temp array to 0 elements
                i = 0; //Reset i as elements were substracted*/
            }

            /*Convert back words if they are just made out of numbers or symbols as its likely that the user did not have that in mind. As the api
            classify words such as wr which can be made out of two numbers which is most likley wrong*/
            var letterAndNumber = /^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]{2}$/;
            var letterAndSymbol = /^(?=.*[a-zA-Z])(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?])[a-zA-Z!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]{2}$/;
            arrayForlength = segmentationPasswordMappedArray;
            for(let i = 0; i < arrayForlength.length; i++){
                if(mirrorCleanArray[i].match(onlyContainNumbers) || mirrorCleanArray[i].match(onlyContainSymbols) || mirrorCleanArray[i].match(onlyContainNumbersAndSymbols)){ 
                    segmentationPasswordMappedArray.splice(i,1,mirrorCleanArray[i].split(""));  //Splice, first index, second how many elements to remove, third add  and split to sub array
                }
                if(mirrorCleanArray[i].length == 2 && mirrorCleanArray[i].match(letterAndNumber) || mirrorCleanArray[i].length == 2 && mirrorCleanArray[i].match(letterAndSymbol) ){
                    console.log(mirrorCleanArray[i]);
                    segmentationPasswordMappedArray.splice(i,1,mirrorCleanArray[i].split(""));
                }
            }
            segmentationPasswordMappedArray = [].concat(...segmentationPasswordMappedArray); //Concat with ...parent array to "unpack" the sub arrays

            
            //Typed in password characters are pushed into array to match segments in segmentationPasswordMappedArray
            for(let i = 0; i < segmentationPasswordMappedArray.length; i++){
        
                for(let j = 0; j < segmentationPasswordMappedArray[i].length; j++){ //Push in i value which match typed in values of segmentationPassword
                    segmentationPasswordArray.push(segmentationPassword[j]) 
                }

                if(i == (segmentationPasswordMappedArray.length-1)){ //Check to see if i is at last element in the array. So " " is not pushed in at the end
                    segmentationPassword = segmentationPassword.substring(segmentationPasswordMappedArray[i].length)
                }else{
                    segmentationPassword = segmentationPassword.substring(segmentationPasswordMappedArray[i].length) //Remove the value of length as for loop j always start at the first value in segmentationPassword
                    segmentationPasswordArray.push(" ")//Adds a seperator " " so when splitting all single elements are still only one element in the array after join 
                }
            }   
            segmentationPasswordArray = segmentationPasswordArray.join('').split(/ /g);
            arrayForlength = segmentationPasswordArray;
            segmentationPasswordArray = [];
   
            //If loop too push in words,numbers,symobls,letters so when joning the value in the array each word, segment of letters/symobls/numbers are seperated by " "
            for (let i = 0; i < arrayForlength.length; i++) {
                if(i < (arrayForlength.length-1)){ //Check to see if i is less then arrayForLength. If i is same value, i+1 will be out of bound
                    if(arrayForlength[i].match(onlyContainNumbers) && arrayForlength[i+1].match(onlyContainNumbers)) //Check if value of i and i+1 both consist of numbers
                    {
                        segmentationPasswordArray.push(arrayForlength[i]);
                    }
                    else if(arrayForlength[i].match(onlyContainSymbols) && arrayForlength[i+1].match(onlyContainSymbols))//Check if value of i and i+1 both consist of symbols
                    {
                        segmentationPasswordArray.push(arrayForlength[i]);
                    }
                    else if(arrayForlength[i].match(onlyLetters) && arrayForlength[i+1].match(onlyLetters))//Check if value of i and i+1 are both consist of symbols
                    {
                        segmentationPasswordArray.push(arrayForlength[i]);
                    }else //if i and i+1 do not match. its an indication of a word or a new segment.
                    {
                        segmentationPasswordArray.push(arrayForlength[i]," ");//Push in value and " " as a new segment will be pushed in next
                    }
                }
                if(i == (arrayForlength.length-1)){ //Check to see if i value is equal to the last element in arraForlengt. Then compare is done to the value before i. As i+1 is out of bound. Same things are happening but with i-1 checks
                        if(arrayForlength[i].match(onlyContainNumbers) && arrayForlength[i-1].match(onlyContainNumbers)){
                        segmentationPasswordArray.push(arrayForlength[i]);
                    }
                    else if(arrayForlength[i].match(onlyContainSymbols) && arrayForlength[i-1].match(onlyContainSymbols))
                    {
                        segmentationPasswordArray.push(arrayForlength[i]);
                    }
                    else if(arrayForlength[i].match(onlyLetters) && arrayForlength[i-1].match(onlyLetters))
                    {
                        segmentationPasswordArray.push(arrayForlength[i]);
                    }
                    else{ 
                        segmentationPasswordArray.push(arrayForlength[i]); //No " " is pushed as its the last value
                    }
                }
            }
            //Display segments for user and prepare array with segments for database search
            
            clearElements(prepareForSend); //clear created divs that displays each segment (if user fails first time, so next try it will not have divs for segments up)
            prepareForSend = segmentationPasswordArray.join("").split(/ /g); //Joins the array to a string and splits at " " and saves it in prepareForSend which will be used to send in segments for test in database    
            containerID = "container";
            displaySegments(prepareForSend,containerID);//Sends in array to function that displays the segments to the user

            for(let i = 0; i < prepareForSend.length; i++){ //If a segment is less or equal to 2 in length. It will be send in as " ", as otherwise it will find hits in every word in the database
                if(prepareForSend[i].length <= 2){
                    readyForSend.push(' ');
                }else{
                    readyForSend.push(prepareForSend[i]);
                }
            };

            //Sends segments to database for search
            
            returnValue = await ajaxFunction(purePassword, readyForSend); //Sends in typed in password with no segments, and segmented password
            returnValue = JSON.parse(returnValue);
            //console.log(returnValue);
            //Displays segment to user

            if(returnValue == true){
                clearElements(prepareForSend);
                msaWarningDiv.style.display = "block";
                msaWarningDiv.style.backgroundColor = "#ED675F";
                msaWarningSpan.innerHTML = "The password " + foundSegmentedPassword + " has been leaked before and is not safe! Try a different password";
                stopLoadingIcon();
            }
            else{    
                for(let i = 0; i < returnValue.length; i++){
                    if(returnValue[i] < 135)
                    {
                        outputElements[i + 1].style.backgroundColor = "lightgreen";                                                 //i+1 beacuse 0 is always empety and first word is at postion 1
                    }
                    else
                    {
                        outputElements[i + 1].style.backgroundColor = "#ED675F";
                        outputElements[i + 1].style.border = "5px dotted black";
                    }
                }
                //Checks if any segment has color of red
                for(let i = 1; i < outputElements.length; i++){
                    color = outputElements[i].style.backgroundColor;
                    if(color == "rgb(237, 103, 95)") {
                        colortest = false;
                    }
                }
                  //Checks if boolean is true or false. If a segment is red it wont go to next page.
                if (colortest == false) {
                    stopLoadingIcon();
                    msaWarningDiv.style.display = "block";
                    msaWarningSpan.innerHTML = "One or more segments are not accepted (red dotted segments are segments not accepted)";
                }
                //If all segments are true then display next page for user
                else if (colortest == true) {
                    stopLoadingIcon();
                    document.getElementById("containerArray").style.justifyContent = "center";
                    containerID = "containerArray";
                    displaySegments(prepareForSend, containerID);
                    document.getElementById("page1").style.display = "none";
                    document.getElementById("page2").style.display = "block";
                }
            }
        }
    </script>
</body>
</html>