<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body onload="">
    <!-- Password box for google guidline passwords-->
    <div>
        <label for="noMSA">Password 1</label>
        <input type="text" id="noMSA" name="noMSA">
        <input type="submit" value="submit1">
    </div>
     <!-- Password box for MSA passwords-->
    <div>
        <label for="MSA">Password 2</label>
        <input type="text" id="MSA" name="MSA">
        <input type="submit" value="submit2" onclick="MSA();">
    </div>
    <script>
         var words; //Global veriabel som håller innehåller alla ord från ordlistan.

       
        //Function for local files.
         /*function compareText(){  //Skriv kommentarer imorgon.
            fetch("wordList.txt") //Hämtar textfilen.
                .then(function(textFile){ //En promise some tar emot datan och en response.
                    return (textFile.text()); //Splitar innehållet på "\n".
            })
            .then(function(data){  //Tar emot datan från returnen.
                words = data.split("\r\n"); //Splittar textfilen och sparar i strängen.
            })
        }*/ 
       function wordChecker(word){
            return new Promise ((resolve,reject) => {
                fetch('https://api.dictionaryapi.dev/api/v2/entries/en/'+word+'')
                    .then(response => response.json())
                    .then(response => {
                        if(response.hasOwnProperty("title")){ //Checks if response object has property word.
                            resolve(false);
                            
                        }else{
                            resolve(true)
                        }
                        
                    }) 
                
                })
                
            }  

        //Algorithm for MSA
       async function MSA(){
            //Varibales
            var password; //Holds passwords from password 2
            var noSpecialCharPassword;
            var searchingWord;
            var leetSearchingWord; //Stores the password created while last character is deleted.
            var wordDetector = 0;
         
            var segmentationTracker = []; //Keeps track of all segmentations
            var leetSegmentationTracker = [];
            var MSACheck = true;
            var segmentedPassword = [];
            var segmentbolean = true;
            var segmentExpectbolean = true;
            var passwordCharChange;
            var expectedPassword = [];
            var expectedPasswordArray = [];
            var savedWords = [];
            var storeSpecialWords = [];
            const containSpeicalCharacter = (/\W/);
            const replaceSpecialChars = { //Created objects
                "@":"a",
                "0":"o"
            }
            var cleanPassword;
            password = document.getElementById("MSA").value;
            cleanPassword = password;

            if(password.match(containSpeicalCharacter)){
        
                noSpecialCharPassword = password.replace(/@|0/g, function(matched){ //Replaces all specialChars with mapped letters
                    
                    return replaceSpecialChars[matched];

                });

            }else{
                noSpecialCharPassword = password;;
            }
            

            while(MSACheck == true){
                
                const alphabet = /^[a-zA-Z]/ //Regex if first char is lower and uppercase charecter
                const alphabet2 = (/[a-z]/);
                const number = /^[0-9]/; //Regex Numbers
                const numbers = (/[0-9]/);
                const notNumber = /^\D/;
                const lastCharNr = (/|0-9]$/);
                const lastCharAP = (/[a-zA-Z]$/);
                const specialCharacter = /^\W/; //Regex special characters
                var wordProcess = false;

                
                /*TODO:
                Efter det fråga mot databasen.
                Efter det formulera tydliga riktlinjer
                Efter det skapa formulär
                Samla in data*/

                for (let i = 0; i < password.length; i++){
                    if(password.match(number)){
                     
                        segmentationTracker.push(password.match(number))
                        password = password.substring(1);

                    }else if(password.match(specialCharacter)){
                        segmentationTracker.push(password.match(specialCharacter))
                        password = password.substring(1);
                    }else{
                        let fetchWord;
                        searchingWord = password.substring(0, password.length - i)
                        fetchWord = await wordChecker(searchingWord); // calls on wordChecker and waits for it to complete

                        if(fetchWord){
                            segmentationTracker.push(searchingWord); //Adds the word to segmentation tracker
                            password = password.replace(`${searchingWord}`, ""); //Replaces the word in password string with nothing.
                            i = 0; //Behövs eftersom en stor del text har försvunnit och annars enbart visar första bokstaven i vad som är kvar
                            
                        }else if(searchingWord.length <= 1){ //If temp.length is less then 1 in length, enter here to remove characters.
                            segmentationTracker.push(searchingWord[0]);
                            password = password.substring(1);
                        
                        }
                        
                    }
                    
                };
                
                if(password.length == 0 ){

                    for (let i = 0; i < noSpecialCharPassword.length; i++){
                        if(noSpecialCharPassword.match(number)){

                            leetSegmentationTracker.push(noSpecialCharPassword.match(number))
                            storeSpecialWords.push(noSpecialCharPassword.match(number));
                            noSpecialCharPassword = noSpecialCharPassword.substring(1);
                         
                        }else if(noSpecialCharPassword.match(specialCharacter)){
                            
                            leetSegmentationTracker.push(noSpecialCharPassword.match(specialCharacter))
                            storeSpecialWords.push(noSpecialCharPassword.match(specialCharacter));
                            noSpecialCharPassword = noSpecialCharPassword.substring(1);

                        }else{
                            let fetchLeetWord;
                            leetSearchingWord = noSpecialCharPassword.substring(0, noSpecialCharPassword.length - i);
                            fetchLeetWord = await wordChecker(leetSearchingWord);

                            if(fetchLeetWord){

                                leetSegmentationTracker.push(leetSearchingWord); //Adds the word to segmentation tracker
                                storeSpecialWords.push(" ");
                                noSpecialCharPassword = noSpecialCharPassword.replace(`${leetSearchingWord}`, ""); //Replaces the word in password string with nothing.
                                i = 0; //Behövs eftersom en stor del text har försvunnit och annars enbart visar första bokstaven i vad som är kvar
                            }
                            else if(leetSearchingWord.length <= 1){
                                leetSegmentationTracker.push(leetSearchingWord[0]);
                                storeSpecialWords.push(leetSearchingWord[0]);
                                noSpecialCharPassword = noSpecialCharPassword.substring(1);
                            }
                        }
                        
                    }
                   
                }

                if(noSpecialCharPassword == 0 && cleanPassword != ""){
                    let temptext;
                    for(let i = 0; i < leetSegmentationTracker.length; i++){
                        temptext = leetSegmentationTracker[i].toString(); 
                        if(leetSegmentationTracker[i].length >= 1 && temptext.match(alphabet)){
                            if (savedWords.length != 0){
                                savedWords.push("-");
                            }
                            for(let j = 0; j < leetSegmentationTracker[i].length; j++){
                                savedWords.push(cleanPassword[j])
                            }

                        }else{
                            cleanPassword = cleanPassword.substring(0);
                        }
                        cleanPassword = cleanPassword.substring(leetSegmentationTracker[i].length)
                    }
                    savedWords = savedWords.join('').split(/-/g);
                    wordProcess = true;
                    
                };
                
                if(wordProcess == true){

                    var segments;
                    var segmentsExpected;
                 
                    segments = segmentationTracker.toString().split(/,/g);//Converts to string and split and save it to varibal segments
                    segmentsExpected = storeSpecialWords.toString().split(/,/g); 


                    if(segmentedPassword.length == 0){
                        segmentedPassword = segmentedPassword.concat(segments[0]);
                        expectedPassword = expectedPassword.concat(segmentsExpected[0]);
                        segments = segments.slice(1);
                        segmentsExpected = segmentsExpected.slice(1);                           

                    }
                        for(let i = 0; segments.length > 0; i++){

                            if(segmentedPassword[i] == ","){ //If , == i, then add 1 to i
                                i++;
                            }
                            if(segmentedPassword[i].match(numbers) && segments[0].match(numbers) ||
                                    segmentedPassword[i].match(specialCharacter) && segments[0].match(specialCharacter) ||
                                    segmentedPassword[i].match(alphabet) && segments[0].match(alphabet) 
                                ){//If i and segment0 is the same char 

                                    segmentedPassword = segmentedPassword.concat(segments[0]);
                                    segments = segments.slice(1);

                            }else{ //if element [i] does not match the char in segments[0]
                              
                                segmentedPassword = segmentedPassword.concat(",",segments[0]); //Cocats , and element to string.
                                segments = segments.slice(1); //Revmoves first element
                            
                            }
                            
                            if(segments.length == 0){ // Exit loop.
                                
                                for(let j = 0; segmentsExpected.length > 0; j++){
                                    
                                    if(expectedPassword[j] == ","){ //If , == j, then add 1 to j
                                        j++;
                                    }

                                    if(expectedPassword[j].match(numbers) && segmentsExpected[0].match(numbers) ||
                                            expectedPassword[j].match(specialCharacter) && segmentsExpected[0].match(specialCharacter) ||
                                            expectedPassword[j].match(alphabet) && segmentsExpected[0].match(alphabet)
                                        ){//If j and segment0 is the same char 

                                        expectedPassword = expectedPassword.concat(segmentsExpected[0]);
                                        segmentsExpected = segmentsExpected.slice(1);
                                        
                                    }else{ //if element [j] does not match the char in segments[0]
                                        expectedPassword = expectedPassword.concat(",",segmentsExpected[0]);//Cocats , and element to string.
                                        segmentsExpected = segmentsExpected.slice(1); //Revmoves first element
                                    
                                    } 
                                    if(segmentsExpected.length < 1){ // Exit loop.
                                        console.log(segmentsExpected)
                                        console.log(savedWords)
                                        alert("segment")
                                        for (let i = 0; i < expectedPassword.length; i++){
                                            if(expectedPassword[i] == " "){
                                                if(expectedPassword[i+1] == " "){
                                                    expectedPassword[i] = savedWords[0]+",";
                                                    savedWords = savedWords.slice(1);
                                                }else{
                                                    expectedPassword[i] = savedWords[0];
                                                    console.log(savedWords[0])
                                                    alert("test")
                                                    savedWords = savedWords.slice(1);
                                                }
                                               
                                            }
                                        }
                                      
                                        MSACheck = false;
                                    }       
                                }
                                    
                            }
                            
                    };
  
                }
            }
            segmentedPassword = segmentedPassword.join(""); //Joins the array to a string and splits at ","
            expectedPassword = expectedPassword.join("");
            console.log("The segmentedPassword is: ", segmentedPassword, "The expected password is: ", expectedPassword);
        }
    </script>
</body>
</html>
