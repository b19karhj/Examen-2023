<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body onload="">
    <!-- Password box for google guidline passwords-->
    <div>
        <label for="noMSA">Password 1</label>
        <input type="text" id="noMSA" name="noMSA">
        <input type="submit" value="submit1">
    </div>
     <!-- Password box for MSA passwords-->
    <div>
        <label for="MSA">Password 2</label>
        <input type="text" id="MSA" name="MSA">
        <input type="submit" value="submit2" onclick="MSA();">
    </div>
    <script>
         var words; //Global veriabel som håller innehåller alla ord från ordlistan.

       
        //Function for local files.
         /*function compareText(){  //Skriv kommentarer imorgon.
            fetch("wordList.txt") //Hämtar textfilen.
                .then(function(textFile){ //En promise some tar emot datan och en response.
                    return (textFile.text()); //Splitar innehållet på "\n".
            })
            .then(function(data){  //Tar emot datan från returnen.
                words = data.split("\r\n"); //Splittar textfilen och sparar i strängen.
            })
        }*/ 
       function wordChecker(word){
            return new Promise ((resolve,reject) => {
                fetch('https://api.dictionaryapi.dev/api/v2/entries/en/'+word+'')
                    .then(response => response.json())
                    .then(response => {
                        if(response.hasOwnProperty("title")){ //Checks if response object has property word.
                            resolve(false);
                            
                        }else{
                            alert(response[0].word)
                            resolve(true)
                        }
                        
                    }) 
                
                })
                
            }  

        //Algorithm for MSA
       async function MSA(){
            //Varibales
            var password; //Holds passwords from password 2
            var noSpecialCharPassword;
            var searchingWord;
            var leetSearchingWord; //Stores the password created while last character is deleted.
            var wordDetector = 0;
         
            var segmentationTracker = []; //Keeps track of all segmentations
            var leetSegmentationTracker = [];
            var MSACheck = true;
            var segmentedPassword = [];
            var segmentbolean = true;
            var segmentExpectbolean = true;
            var passwordCharChange;
            var expectedPassword = [];
            var expectedPasswordArray = [];
            var savedWords = [];
            var storeSpecialWords = [];
            const containSpeicalCharacter = (/\W/);
            const replaceSpecialChars = { //Created objects
                "@":"a",
                "0":"o"
            
            }
            var cleanPassword;
            password = document.getElementById("MSA").value;
            //password = "p@ssw0rd123w0rd";
            cleanPassword = password;
            

            

            
           /* for(const [key, value] of Object.entries(replaceSpecialChars)){
                alert(`${key}: ${value}`);
            }*/

            //alert(password, "active password")

            if(password.match(containSpeicalCharacter)){
                    //alert("SpecialCharacter detected")
                    noSpecialCharPassword = password.replace(/@|0/g, function(matched){ //Replaces all specialChars with mapped letters
                      
                        //alert(matched, "Matched");
                        //alert("test")
                        return replaceSpecialChars[matched];
                        //i++;
                        //alert(i)
                    
                    
                    });
                    //alert(noSpecialCharPassword)
                    //alert("transform over");
                      
                    //for(const [key, value] of Object.entries(placementholder)){
                      //  alert(`${key}: ${value}`);
                    //}
            }
            
            
        
           
            while(MSACheck == true){
            const alphabet = /^[a-zA-Z]/ //Regex if first char is lower and uppercase charecter
            const alphabet2 = (/[a-z]/);
            const number = /^[0-9]/; //Regex Numbers
            const numbers = (/[0-9]/);
            const notNumber = /^\D/;
            const lastCharNr = (/|0-9]$/);
            const lastCharAP = (/[a-zA-Z]$/);
            const specialCharacter = /^\W/; //Regex special characters
            var wordProcess = false;
            
                /*if(password.match(number) || password.match(specialCharacter)){ //Checks if first element is number or special character
                    alert("password")
                }*/
             
             
           

              
                
                //}
                
                /*TODO:
                Rad 198 försök komma på orginal iden.
                Efter det fråga mot databasen.
                Efter det formulera tydliga riktlinjer
                Efter det skapa formulär
                Samla in data*/

                for (let i = 0; i < password.length; i++){
                    if(password.match(number)){
                     
                        segmentationTracker.push(password.match(number))
                        password = password.substring(1);
                     
                        
                    }else if(password.match(specialCharacter)){
                        segmentationTracker.push(password.match(specialCharacter))
                        password = password.substring(1);
                    }else{
                        let fetchWord;
                        searchingWord = password.substring(0, password.length - i)
                        fetchWord = await wordChecker(searchingWord); // calls on wordChecker and waits for it to complete
                       
                        if(fetchWord){
                            "test"
                            console.log("word found");
                            console.log(searchingWord)
                            //console.log(temp);
                            //wordDetector++;
                            segmentationTracker.push(searchingWord); //Adds the word to segmentation tracker
                            password = password.replace(`${searchingWord}`, ""); //Replaces the word in password string with nothing.
                            
                        }else if(searchingWord.length <= 1){ //If temp.length is less then 1 in length, enter here to remove characters.
                            alert("Should not be inside")
                            segmentationTracker.push(searchingWord[0]);
                            password = password.substring(1);
                        
                        }
                        
                    }
                  
                    
                };
                
                if(password == 0){
                    console.log(segmentationTracker, "should show array")
                    console.log(password)
                    console.log(noSpecialCharPassword)
                    console.log(noSpecialCharPassword.length)
                    alert("inne!")
                    for (let i = 0; i < noSpecialCharPassword.length; i++){
                        if(noSpecialCharPassword.match(number) || noSpecialCharPassword.match(specialCharacter)){
                            leetSegmentationTracker.push(noSpecialCharPassword[0])
                           
                            console.log(noSpecialCharPassword, "after cut")
                            i = 0;
                        }else{
                            console.log(noSpecialCharPassword, "Check password")
                            console.log(leetSegmentationTracker, "tracker")
                            //alert("Hello")
                            let fetchLeetWord;
                            leetSearchingWord = noSpecialCharPassword.substring(0, noSpecialCharPassword.length - i);
                            console.log(leetSearchingWord)
                            alert("ord")
                            fetchLeetWord = await wordChecker(leetSearchingWord);
                            if(fetchLeetWord){
                                alert("Word Found second!")
                                console.log(fetchLeetWord)
                                leetSegmentationTracker.push(leetSearchingWord); //Adds the word to segmentation tracker
                                storeSpecialWords.push(" ");
                                //alert("pause")
                                noSpecialCharPassword = noSpecialCharPassword.replace(`${leetSearchingWord}`,""); //Replaces the word in password string with nothing.
                                fetchLeetWord = false;
                            }
                            else if(leetSearchingWord.length <= 1){
                                leetSegmentationTracker.push(leetSearchingWord[0]);
                                storeSpecialWords.push(leetSearchingWord[0]);
                                noSpecialCharPassword = noSpecialCharPassword.substring(1);
                            }
                        }
                        noSpecialCharPassword = noSpecialCharPassword.substring(noSpecialCharPassword.length - i);
                    }
                }
                
                if(noSpecialCharPassword == 0 && cleanPassword != ""){
                    console.log(storeSpecialWords, "This is correct?");
                    console.log(leetSegmentationTracker)
                    alert("Check if correct!");
                   
                    for(let i = 0; i < leetSegmentationTracker.length; i++){
                        
                        if(leetSegmentationTracker[i].length > 1){
                            if (savedWords.length != 0){
                                savedWords.push("-");
                            }
                            for(let j = 0; j < leetSegmentationTracker[i].length; j++){
                               // console.log(leetSegmentationTracker[i], "this is i value")
                                //console.log("value of j: ",j)
                                ///console.log(cleanPassword[j] , "before slice")
                                savedWords.push(cleanPassword[j])
                                //console.log(savedWords, "saved  so far")
                                //console.log(cleanPassword, "this is left");
                                //console.log(cleanPassword[0], "this is first char")
                               
                            }
                            //savedWords = savedWords.join('');
                            
                        }else{
                            cleanPassword = cleanPassword.substring(0);
                        }
                        cleanPassword = cleanPassword.substring(leetSegmentationTracker[i].length)
                    }
                    savedWords = savedWords.join('').split(/-/g);
                    wordProcess = true;
                    
                };
                
                if(wordProcess == true){
                    console.log(savedWords, "savedwords")
                    alert("Should be working by now")
                    console.log(segmentationTracker)
                    //console.log(leetSegmentationTracker)
                  
                    var segments;
                    var segmentsExpected;
                 
                    segments = segmentationTracker.toString().split(/,/g);//Converts to string and split and save it to varibal segments
                    segmentsExpected = storeSpecialWords.toString().split(/,/g); 
                    console.log(segments, "segments");
                    console.log(segmentsExpected, " expected segments") //correct
                    

                    if(segmentedPassword.length == 0){
                        segmentedPassword = segmentedPassword.concat(segments[0]);
                        expectedPassword = expectedPassword.concat(segmentsExpected[0]);
                        segments = segments.slice(1);
                        segmentsExpected = segmentsExpected.slice(1);                           
                        /*console.log(segments) 
                        console.log(segmentsExpected) 
                        console.log(segmentedPassword);
                        console.log(expectedPassword);*/    
                                   
                    }
                        for(let i = 0; segments.length > 0; i++){
                            console.log(segmentedPassword, "segment password")
                            console.log(segments, "Segment");
                            console.log(i, "i is");
        

                            if(segmentedPassword[i] == ","){ //If , == i, then add 1 to i
                                i++;
                            }
                            if(segmentedPassword[i].match(numbers) && segments[0].match(numbers) ||
                                    segmentedPassword[i].match(specialCharacter) && segments[0].match(specialCharacter) ||
                                    segmentedPassword[i].match(alphabet) && segments[0].match(alphabet) 
                                ){//If i and segment0 is the same char 

                                    segmentedPassword = segmentedPassword.concat(segments[0]);
                                    segments = segments.slice(1);

                            }else{ //if element [i] does not match the char in segments[0]
                              
                                segmentedPassword = segmentedPassword.concat(",",segments[0]); //Cocats , and element to string.
                                console.log(segmentedPassword, "if two chars are NOT the same");
                                segments = segments.slice(1); //Revmoves first element
                            
                            }

                            if(segments.length == 0){ // Exit loop.
                                console.log(segmentsExpected);
                               
                                
                                for(let j = 0; segmentsExpected.length > 0; j++){
                                    
                                    if(expectedPassword[j] == ","){ //If , == j, then add 1 to j
                                        j++;
                                    }

                                    if(expectedPassword[j].match(numbers) && segmentsExpected[0].match(numbers) ||
                                            expectedPassword[j].match(specialCharacter) && segmentsExpected[0].match(specialCharacter) ||
                                            expectedPassword[j].match(alphabet) && segmentsExpected[0].match(alphabet)
                                        ){//If j and segment0 is the same char 

                                        expectedPassword = expectedPassword.concat(segmentsExpected[0]);
                                        segmentsExpected = segmentsExpected.slice(1);
                                        
                                    }else{ //if element [j] does not match the char in segments[0]
                                        expectedPassword = expectedPassword.concat(",",segmentsExpected[0]);//Cocats , and element to string.
                                        segmentsExpected = segmentsExpected.slice(1); //Revmoves first element
                                    
                                    } 
                                    
                                    if(segmentsExpected.length < 1){ // Exit loop.
                                        console.log(expectedPassword, "words")
                                        alert("inne")
                                        for (let i = 0; i < expectedPassword.length; i++){
                                            if(expectedPassword[i] == " "){
                                                expectedPassword[i] = savedWords[1];
                                                alert(savedWords[1])
                                                savedWords = savedWords.slice(1);
                                            }
                                        }
                                      
                                        MSACheck = false;
                                    }       
                                }
                                    
                            }
                            
                        
                    };
                    //TODO Works but goes on forever.
                    
                    
                }
            }
            segmentedPassword = segmentedPassword.join(""); //Joins the array to a string and splits at ","
            expectedPassword = expectedPassword.join("");
            console.log("The segmentedPassword is: ", segmentedPassword, "The expected password is: ", expectedPassword);
            console.log("password is no more", password);       
              
        }
   
    </script>
</body>
</html>
